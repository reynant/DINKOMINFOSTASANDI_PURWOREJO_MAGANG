<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard Admin</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css"/>
  <style>.scrollbar-hidden::-webkit-scrollbar{display:none}</style>
</head>
<body>

  {% include "admin/sidebar.html" %}

  <div class="container mt-4">
    <h3>Dashboard</h3>

    <div class="card mt-3">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="mb-0">Kategori Berita</h5>
        <a href="#" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#modalTambah">
          Tambahkan Data
        </a>
      </div>

      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <div class="d-flex align-items-center">
            Show
            <select class="form-select form-select-sm mx-2" style="width:auto">
              <option>10</option><option>25</option><option>50</option><option>100</option>
            </select>
            entries
          </div>
          <div><input type="search" class="form-control form-control-sm" placeholder="Search..."/></div>
        </div>

        <div class="table-responsive">
          <table class="table table-bordered table-striped table-sm">
            <thead class="table-light">
                <tr>
                  <th>No</th>
                  <th>Nama</th>
                  <th>Email</th>
                  <th>Subjek</th>
                  <th>Tanggal</th>
                  <th>Aksi</th>
                </tr>
              </thead>
              <tbody>
                {% if pesan_masuk %}
                  {% for pesan in pesan_masuk %}
                  <tr>
                    <td>{{ loop.index }}</td>
                    <td>{{ pesan.nama }}</td>
                    <td>{{ pesan.email }}</td>
                    <td>{{ pesan.subjek }}</td>
                    <td>{{ pesan.tanggal }}</td>
                    <td>
                      <button class="btn btn-warning btn-sm me-1" 
                              data-bs-toggle="modal" 
                              data-bs-target="#modalEdit"
                              data-id="{{ pesan.id }}"
                              data-nama="{{ pesan.nama }}"
                              data-email="{{ pesan.email }}"
                              data-subjek="{{ pesan.subjek }}"
                              data-tanggal="{{ pesan.tanggal }}"
                              onclick="setEditData(this)">
                        Edit
                      </button>
                      <form action="{{ url_for('admin.hapus_pesan_masuk', id=pesan.id) }}" method="POST" style="display:inline;">
                        <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Hapus data ini?')">
                          Hapus
                        </button>
                      </form>
                    </td>
                  </tr>
                  {% endfor %}
                {% else %}
                  <tr>
                    <td colspan="6" class="text-center">Tidak ada data</td>
                  </tr>
                {% endif %}
              </tbody>
            </table>
          </div>

          <div class="card-footer">
            <div class="d-flex justify-content-between align-items-center">
              <div>Showing {{ pesan_masuk|length if pesan_masuk else 0 }} entries</div>
              <nav>
                <ul class="pagination pagination-sm mb-0">
                  <li class="page-item disabled"><a class="page-link" href="#">Previous</a></li>
                  <li class="page-item active"><a class="page-link" href="#">1</a></li>
                  <li class="page-item disabled"><a class="page-link" href="#">Next</a></li>
                </ul>
              </nav>
            </div>
            
            <div class="text-center mt-3">
              <p class="text-muted small mb-0">
                Copyright Â© 2014-2025 Dinas Komunikasi, Informatika, Statistik dan Persandian Kabupaten Purworejo. 
                All rights reserved. Version 3.0.0
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal Tambah -->
    <div class="modal fade" id="modalTambah" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Tambah Pesan Masuk</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <form method="POST" action="{{ url_for('admin.tambah_pesan_masuk') }}">
            <div class="modal-body">
              <div class="mb-3">
                <label class="form-label">Nama</label>
                <input type="text" name="nama" class="form-control" required>
              </div>
              <div class="mb-3">
                <label class="form-label">Email</label>
                <input type="email" name="email" class="form-control" required>
              </div>
              <div class="mb-3">
                <label class="form-label">Subjek</label>
                <input type="text" name="subjek" class="form-control" required>
              </div>
              <div class="mb-3">
                <label class="form-label">Tanggal</label>
                <input type="date" name="tanggal" class="form-control" required>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
              <button type="submit" class="btn btn-primary">Simpan</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Modal Edit -->
    <div class="modal fade" id="modalEdit" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Edit Pesan Masuk</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <form id="formEdit" method="POST">
            <div class="modal-body">
              <input type="hidden" name="id" id="editId">
              <div class="mb-3">
                <label class="form-label">Nama</label>
                <input type="text" name="nama" id="editNama" class="form-control" required>
              </div>
              <div class="mb-3">
                <label class="form-label">Email</label>
                <input type="email" name="email" id="editEmail" class="form-control" required>
              </div>
              <div class="mb-3">
                <label class="form-label">Subjek</label>
                <input type="text" name="subjek" id="editSubjek" class="form-control" required>
              </div>
              <div class="mb-3">
                <label class="form-label">Tanggal</label>
                <input type="date" name="tanggal" id="editTanggal" class="form-control" required>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
              <button type="submit" class="btn btn-primary">Simpan Perubahan</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Fungsi untuk mengisi data edit
      function setEditData(button) {
        const id = button.getAttribute('data-id');
        const nama = button.getAttribute('data-nama');
        const email = button.getAttribute('data-email');
        const subjek = button.getAttribute('data-subjek');
        const tanggal = button.getAttribute('data-tanggal');
        
        document.getElementById('editId').value = id;
        document.getElementById('editNama').value = nama;
        document.getElementById('editEmail').value = email;
        document.getElementById('editSubjek').value = subjek;
        document.getElementById('editTanggal').value = tanggal;
        
        // Set action form
        document.getElementById('formEdit').action = "{{ url_for('admin.edit_pesan_masuk', id=0) }}".replace('0', id);
      }

      // Fungsi filter tabel
      function filterTable() {
        const input = document.querySelector('input[type="search"]');
        const filter = input.value.toLowerCase();
        const table = document.querySelector('table');
        const rows = table.querySelectorAll('tbody tr');
        
        rows.forEach(row => {
          const nama = row.querySelector('td:nth-child(2)').textContent.toLowerCase();
          const email = row.querySelector('td:nth-child(3)').textContent.toLowerCase();
          
          if (nama.includes(filter) || email.includes(filter)) {
            row.style.display = '';
          } else {
            row.style.display = 'none';
          }
        });
      }
    </script>
  </body>
</html>