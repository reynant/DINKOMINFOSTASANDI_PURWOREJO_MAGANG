<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard Admin - Kominfo</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css"/>
  <style>
    .scrollbar-hidden::-webkit-scrollbar { display: none; }
    body { overflow: hidden; }
    
    /* Enhanced Animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes slideInLeft {
      from { opacity: 0; transform: translateX(-50px); }
      to { opacity: 1; transform: translateX(0); }
    }
    
    @keyframes slideInRight {
      from { opacity: 0; transform: translateX(50px); }
      to { opacity: 1; transform: translateX(0); }
    }
    
    @keyframes scaleIn {
      from { opacity: 0; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1); }
    }
    
    @keyframes bounce {
      0%, 20%, 53%, 80%, 100% { transform: translate3d(0,0,0); }
      40%, 43% { transform: translate3d(0, -10px, 0); }
      70% { transform: translate3d(0, -5px, 0); }
      90% { transform: translate3d(0, -2px, 0); }
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    
    @keyframes glow {
      0%, 100% { box-shadow: 0 0 20px rgba(168, 85, 247, 0.4); }
      50% { box-shadow: 0 0 30px rgba(168, 85, 247, 0.6), 0 0 40px rgba(168, 85, 247, 0.3); }
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }
    
    @keyframes shimmer {
      0% { background-position: -200px 0; }
      100% { background-position: 200px 0; }
    }
    
    /* Animation Classes */
    .animate-fadeIn { animation: fadeIn 0.8s ease-out; }
    .animate-slideInLeft { animation: slideInLeft 0.8s ease-out; }
    .animate-slideInRight { animation: slideInRight 0.8s ease-out; }
    .animate-scaleIn { animation: scaleIn 0.6s ease-out; }
    .animate-bounce-custom { animation: bounce 2s infinite; }
    .animate-pulse-custom { animation: pulse 3s infinite; }
    .animate-glow { animation: glow 2s infinite; }
    .animate-float { animation: float 3s ease-in-out infinite; }
    
    /* Delay Classes */
    .delay-100 { animation-delay: 0.1s; }
    .delay-200 { animation-delay: 0.2s; }
    .delay-300 { animation-delay: 0.3s; }
    .delay-400 { animation-delay: 0.4s; }
    
    /* Card Hover Effects */
    .card-hover {
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .card-hover::before {
      content: '';
      position: absolute;
      top: 0;
      left: -200px;
      width: 200px;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      animation: shimmer 3s infinite;
    }
    
    .card-hover:hover {
      transform: translateY(-8px) scale(1.02);
      box-shadow: 0 20px 40px rgba(0,0,0,0.15);
    }
    
    /* Gradient Backgrounds */
    .admin-gradient-1 { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    .admin-gradient-2 { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
    .admin-gradient-3 { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
    .admin-gradient-4 { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); }
    .admin-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    
    /* Icon Animation */
    .icon-spin {
      transition: transform 0.3s ease;
    }
    
    .card-hover:hover .icon-spin {
      transform: rotate(360deg);
    }
    
    /* Progress Bar Animation */
    .progress-bar {
      width: 0%;
      animation: progressFill 2s ease-out forwards;
    }
    
    @keyframes progressFill {
      to { width: 100%; }
    }
    
    /* Comment Item Hover */
    .comment-item {
      transition: all 0.2s ease;
      border-left: 4px solid transparent;
    }
    
    .comment-item:hover {
      border-left-color: #8b5cf6;
      background: linear-gradient(90deg, #faf5ff, #f3e8ff);
      transform: translateX(8px);
    }
    
    /* Custom Scrollbar */
    .custom-scrollbar::-webkit-scrollbar { width: 6px; }
    .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
    .custom-scrollbar::-webkit-scrollbar-thumb { background: #8b5cf6; border-radius: 10px; }
    .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #7c3aed; }
  </style>
</head>
<body class="admin-bg min-h-screen">
  <div class="relative min-h-screen flex flex-col lg:flex-row">
    
    <div id="sidebar-overlay" class="fixed inset-0 bg-black/50 z-30 hidden lg:hidden"></div>

    <div id="sidebar" class="fixed inset-y-0 left-0 z-40 w-64 transform -translate-x-full transition-transform duration-300 ease-in-out lg:relative lg:translate-x-0">
      {% include "admin/sidebar.html" %}
    </div>

    <main class="flex-grow-1 overflow-y-auto custom-scrollbar" style="height: 100vh">
      <header class="sticky top-0 z-20 flex items-center justify-between bg-white/95 backdrop-blur-sm shadow-lg px-4 sm:px-6 py-4 animate-slideInLeft">
        <div class="flex items-center gap-4">
          <button id="burger-btn" class="lg:hidden text-purple-600 text-2xl focus:outline-none">
            <i class="bi bi-list"></i>
          </button>
          <div class="text-lg sm:text-xl font-bold text-purple-600">
            <i class="bi bi-speedometer2 mr-2"></i>
            üìä Admin Dashboard
          </div>
        </div>
        <div class="flex items-center gap-4">
          <div class="relative">
            <button id="userMenuButton" class="flex items-center space-x-2 text-gray-600 hover:text-purple-600 transition-all duration-300 hover:scale-105">
              <div class="relative">
                <i class="bi bi-person-circle text-xl animate-float"></i>
                  <div class="absolute -top-1 -right-1 w-3 h-3 bg-green-400 rounded-full animate-pulse-custom"></div>
                  </div>
                  <span class="hidden sm:inline">
                    üëã <strong>{{ (session.user or 'User') | capitalize }}</strong>
                  </span>
                <i class="bi bi-chevron-down transition-transform duration-200"></i>
            </button>
            <div id="userMenuDropdown"
                 class="hidden absolute right-0 mt-2 w-48 bg-white/95 backdrop-blur-sm rounded-xl shadow-2xl py-2 z-50 animate-scaleIn border border-purple-100">
              <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-purple-50 hover:text-purple-600 transition-all duration-200">
                <i class="bi bi-person-badge mr-2"></i> Profile
              </a>
              <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-purple-50 hover:text-purple-600 transition-all duration-200">
                <i class="bi bi-gear mr-2"></i> Settings
              </a>
              <div class="border-t border-gray-100 my-1"></div>
              <a href="{{ url_for('admin.logout') }}" onclick="return confirm('Apakah Anda yakin ingin logout?')"
                 class="block px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition-all duration-200">
                <i class="bi bi-box-arrow-right mr-2"></i> Logout
              </a>
            </div>
          </div>
        </div>
      </header>

      <section class="px-4 sm:px-6 py-6 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
        <div class="admin-gradient-1 text-white p-6 rounded-2xl shadow-lg card-hover animate-fadeIn delay-100 relative overflow-hidden">
          <div class="flex items-center justify-between relative z-10">
            <div>
              <div class="text-sm uppercase tracking-wide opacity-90">List Berita</div>
              <div class="text-3xl sm:text-4xl font-bold mt-2 number-counter">{{ total_berita }}</div>
              <div class="w-full bg-white/20 rounded-full h-2 mt-3">
                <div class="bg-white h-2 rounded-full progress-bar"></div>
              </div>
            </div>
            <i class="bi bi-newspaper text-4xl sm:text-5xl opacity-80 icon-spin"></i>
          </div>
        </div>

        <div class="admin-gradient-2 text-white p-6 rounded-2xl shadow-lg card-hover animate-fadeIn delay-200 relative overflow-hidden">
          <div class="flex items-center justify-between relative z-10">
            <div>
              <div class="text-sm uppercase tracking-wide opacity-90">Kategori Berita</div>
              <div class="text-3xl sm:text-4xl font-bold mt-2 number-counter">{{ total_kategori }}</div>
              <div class="w-full bg-white/20 rounded-full h-2 mt-3">
                <div class="bg-white h-2 rounded-full progress-bar"></div>
              </div>
            </div>
            <i class="bi bi-folder text-4xl sm:text-5xl opacity-80 icon-spin"></i>
          </div>
        </div>

        <div class="admin-gradient-3 text-white p-6 rounded-2xl shadow-lg card-hover animate-fadeIn delay-300 relative overflow-hidden">
          <div class="flex items-center justify-between relative z-10">
            <div>
              <div class="text-sm uppercase tracking-wide opacity-90">Tag Berita</div>
              <div class="text-3xl sm:text-4xl font-bold mt-2 number-counter">{{ total_tag }}</div>
              <div class="w-full bg-white/20 rounded-full h-2 mt-3">
                <div class="bg-white h-2 rounded-full progress-bar"></div>
              </div>
            </div>
            <i class="bi bi-tags text-4xl sm:text-5xl opacity-80 icon-spin"></i>
          </div>
        </div>

        <div class="admin-gradient-4 text-gray-800 p-6 rounded-2xl shadow-lg card-hover animate-fadeIn delay-400 relative overflow-hidden">
          <div class="flex items-center justify-between relative z-10">
            <div>
              <div class="text-sm uppercase tracking-wide opacity-90">Users</div>
              <div class="text-3xl sm:text-4xl font-bold mt-2 number-counter">{{ total_user }}</div>
              <div class="w-full bg-gray-800/20 rounded-full h-2 mt-3">
                <div class="bg-gray-800 h-2 rounded-full progress-bar"></div>
              </div>
            </div>
            <i class="bi bi-people text-4xl sm:text-5xl opacity-80 icon-spin"></i>
          </div>
        </div>
      </section>

      <section class="px-4 sm:px-6 pb-6 grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div class="bg-white/95 backdrop-blur-sm p-6 rounded-2xl shadow-xl animate-slideInLeft border border-purple-100">
          <div class="flex justify-between items-center mb-4">
            <h2 class="font-bold text-xl text-purple-600 flex items-center">
              <i class="bi bi-chat-dots mr-2"></i>
              üí¨ Komentar Terbaru
            </h2>
            <a href="{{ url_for('admin.komentar_berita') }}" 
               class="text-purple-600 text-sm hover:text-purple-800 transition-all duration-200 hover:scale-105 flex items-center">
              Lihat Semua <i class="bi bi-arrow-right ml-1"></i>
            </a>
          </div>
          <div class="space-y-3 text-sm max-h-96 overflow-y-auto custom-scrollbar">
            {% for komentar in komentar_terbaru %}
            <div class="comment-item bg-gray-50/80 p-4 rounded-xl hover:shadow-md transition-all duration-300">
              <a href="{{ url_for('admin.detail_berita', id=komentar['berita_id']) }}" 
                 class="text-purple-600 font-semibold hover:text-purple-800 transition-colors">
                {{ komentar['judul'] if komentar['judul'] else 'Tanpa Judul' }}
              </a>
              <div class="mt-2 flex items-center space-x-2">
                <span class="text-pink-500 font-bold">{{ komentar['nama'] }}</span>
                <span class="text-gray-400">‚Ä¢</span>
                <span class="text-green-600">
                  {% if komentar['tanggal'] %} 
                    {{ komentar['tanggal'].strftime('%d %B %Y') }} 
                  {% else %} 
                    - 
                  {% endif %}
                </span>
              </div>
              <div class="mt-2 text-gray-700">
                üìù {{ komentar['isi']|truncate(80) }}
              </div>
            </div>
            {% else %}
            <div class="text-center py-8 text-gray-500 italic">
              <i class="bi bi-chat-square-text text-4xl mb-2 opacity-50"></i>
              <div>Belum ada komentar</div>
            </div>
            {% endfor %}
          </div>
        </div>

        <div class="bg-white/95 backdrop-blur-sm p-6 rounded-2xl shadow-xl animate-slideInRight border border-purple-100">
          <h2 class="font-bold mb-4 text-xl text-purple-600 flex items-center">
            <i class="bi bi-graph-up mr-2"></i>
            üìà Grafik Kunjungan
          </h2>
          <div class="relative">
            <img src="https://via.placeholder.com/500x220/8b5cf6/ffffff?text=Grafik+Kunjungan+Admin"
                 alt="Grafik Dashboard Admin"
                 class="rounded-xl shadow-md w-full hover:scale-105 transition-transform duration-300" />
            <div class="absolute top-2 right-2 bg-purple-600 text-white text-xs px-2 py-1 rounded-full animate-pulse-custom">
              Live
            </div>
          </div>
        </div>
      </section>

      <footer class="text-center text-xs text-white py-4 admin-gradient-1 animate-fadeIn">
        ¬© 2014-2025
        <span class="font-semibold">Dinas Komunikasi, Informatika, Statistik dan Persandian Kabupaten Purworejo</span>.
        All rights reserved.
        <span class="text-purple-200">Version 3.0.0 - Admin Panel</span>
      </footer>
    </main>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // --- RESPONSIVE SIDEBAR (BURGER MENU) LOGIC ---
      const burgerBtn = document.getElementById('burger-btn');
      const sidebar = document.getElementById('sidebar');
      const overlay = document.getElementById('sidebar-overlay');

      function toggleSidebar() {
          sidebar.classList.toggle('-translate-x-full');
          overlay.classList.toggle('hidden');
      }

      if (burgerBtn && sidebar && overlay) {
          burgerBtn.addEventListener('click', toggleSidebar);
          overlay.addEventListener('click', toggleSidebar);
      }

      // --- USER MENU DROPDOWN LOGIC ---
      const userMenuButton = document.getElementById('userMenuButton');
      const userMenuDropdown = document.getElementById('userMenuDropdown');
      
      if (userMenuButton && userMenuDropdown) {
          const chevronIcon = userMenuButton.querySelector('.bi-chevron-down');
          
          userMenuButton.addEventListener('click', () => {
              userMenuDropdown.classList.toggle('hidden');
              chevronIcon.style.transform = userMenuDropdown.classList.contains('hidden') 
                  ? 'rotate(0deg)' : 'rotate(180deg)';
          });

          document.addEventListener('click', (event) => {
              if (!userMenuButton.contains(event.target) && !userMenuDropdown.contains(event.target)) {
                  userMenuDropdown.classList.add('hidden');
                  chevronIcon.style.transform = 'rotate(0deg)';
              }
          });
      }

      // --- NUMBER COUNTER ANIMATION ---
      const counters = document.querySelectorAll('.number-counter');
      counters.forEach(counter => {
        const target = parseInt(counter.textContent, 10) || 0;
        counter.textContent = '0'; // Start from 0
        let current = 0;
        const increment = target / 50; // Controls animation speed
        const timer = setInterval(() => {
          current += increment;
          if (current >= target) {
            counter.textContent = target;
            clearInterval(timer);
          } else {
            counter.textContent = Math.floor(current);
          }
        }, 30);
      });
    });
  </script>
</body>
</html>